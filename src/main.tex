\documentclass[11pt % Font size
              ]{article}
\usepackage[ a4paper % Paper size and format
           , onecolumn % Number of columns: onecolumn or twocolumn
           , total={6in, 8in} % Text area: {width, height}
           ]{geometry}

\title{A Model Theoretic Study of Allen's Interval Algebra}
\author{Bruno da Rocha Paiva - bmd18}
\date{} % Date of writing: empty, today or 25.12.00

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{parskip}
\usepackage{tikz}
\usepackage{quiver}


\usepackage{subfiles}

% Used to scale tikz-cd diagrams properly
\tikzcdset{scale cd/.style={every label/.append style={scale=#1},
    cells={nodes={scale=#1}}}}

% General Symbols
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}

% Category Theory
\newcommand{\id}[1]{\text{id}_{#1}}
\newcommand{\unit}[1]{\eta_{#1}}
\newcommand{\counit}[1]{\epsilon_{#1}}

% Model Theory
\newcommand{\lang}{\mathcal{L}}
\newcommand{\theory}{\mathbb{T}}
\newcommand{\age}[1]{\text{Age}\left(#1\right)}

\newcommand{\finslo}{\textbf{FCh}}
\newcommand{\finaia}{\textbf{FIA}}


\newcommand{\lslo}{\lang_\text{SLO}}
\newcommand{\tslo}{\theory_\text{SLO}}

% Allen Interval Algebra Symbols
\newcommand{\laia}{\lang_\text{AIA}}
\newcommand{\taia}{\theory_\text{AIA}}
\newcommand{\istart}[1]{#1_{-}}
\newcommand{\iend}[1]{#1_{+}}
\newcommand{\aiaindex}{\{<,m,o,s,f,d\}}

% Allen Interval Algebra Relations
\newcommand{\aiaarrow}[1]{\overset{#1}{\longrightarrow}}
\newcommand{\raiaarrow}[1]{\overset{#1}{\longleftarrow}}
\newcommand{\before}{\aiaarrow{<}}
\newcommand{\meets}{\aiaarrow{m}}
\newcommand{\overlaps}{\aiaarrow{o}}
\newcommand{\starts}{\aiaarrow{s}}
\newcommand{\finishes}{\aiaarrow{f}}
\newcommand{\contained}{\aiaarrow{d}}
\newcommand{\after}{\raiaarrow{<}}
\newcommand{\metby}{\raiaarrow{m}}
\newcommand{\overlappedby}{\raiaarrow{o}}
\newcommand{\startedby}{\raiaarrow{s}}
\newcommand{\finishedby}{\raiaarrow{f}}
\newcommand{\contains}{\raiaarrow{d}}

% Categories of models
\newcommand{\mods}[2]{\text{Mod}\left(#1,#2\right)}
\newcommand{\aias}{\mods{\laia}{\taia}}
\newcommand{\slos}{\mods{\lslo}{\tslo}}

% Intervals construction
\newcommand{\inter}[1][-]{\text{Int}\left(#1\right)}
\newcommand{\defformula}[1]{\phi_{#1}}
\newcommand{\beforef}{\defformula{\before}}
\newcommand{\meetsf}{\defformula{\meets}}
\newcommand{\overlapsf}{\defformula{\overlaps}}
\newcommand{\startsf}{\defformula{\starts}}
\newcommand{\finishesf}{\defformula{\finishes}}
\newcommand{\containedf}{\defformula{\contained}}

% Points construction
\newcommand{\psim}{\sim}
\newcommand{\peq}{\phi_\sim}
\newcommand{\plt}{\phi_<}
\newcommand{\points}[1][-]{\text{Pts}\left(#1\right)}

% Environments
\theoremstyle{plain}
\newtheorem{thm}{Theorem}%[subsection]
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}

\theoremstyle{remark}
\newtheorem*{rem}{Remark}

\begin{document}

\maketitle

\begin{defn}
  We define the language of strict linear orders $\lslo$ as the single binary relation $\{ < \}$.

  We define the theory of strict linear orders as
  \begin{align*}
    \tslo = \{ & \forall a, \lnot\ a < a, \\
              & \forall a, \forall b, \forall c, a < b \land b < c \rightarrow a < c \\
              & \forall a, \forall b, a < b \lor a = b \lor b < a \}
  \end{align*}
\end{defn}

\begin{defn}
  We define the language of Allen interval algebras $\laia$ as
  \begin{equation*}
    \laia = \{ \before, \meets, \overlaps, \starts, \finishes, \contained,
               \after, \metby, \overlappedby, \startedby, \finishedby, \contains \}
  \end{equation*}

  (Unsure on how to best write out the definition of $\taia$, especially with the "transitivity"
  axioms).
\end{defn}

% ------ Justifying this axiomatisation of interval algebras

\begin{defn}
  Given a linear order $L$ we define its set of non-zero intervals $\inter[P]$ as the set
  \begin{equation*}
    \inter[L] = \left\{(x_1,x_2)\ |\ x_1 < x_2 \right\} \subseteq L^2
  \end{equation*}
  We can turn this into a $\laia$-structure under the interpretations:
  \begin{itemize}
    \item $(x_1,x_2) \aiaarrow{i} (y_1,y_2)$ if and only if
      $L \models \defformula{\aiaarrow{i}}(x_1,x_2,y_1,y_2)$.
    \item $(x_1,x_2) \raiaarrow{i} (y_1,y_2)$ if and only if
      $L \models \defformula{\aiaarrow{i}}(y_1,y_2,x_1,x_2)$.
  \end{itemize}
  where we range $i$ over the indexing set $\aiaindex$ and define the first order
  $\lslo$-formulas by
  \begin{align*}
    \beforef(x_1,x_2,y_1,y_2)    & = \left(x_1 < x_2\right) \land \left(x_2 < y_1\right) \land
      \left(y_1 < y_2\right) \\
    \meetsf(x_1,x_2,y_1,y_2)     & = \left(x_1 < x_2\right) \land \left(x_2 = y_1\right) \land
      \left(y_1 < y_2\right) \\
    \overlapsf(x_1,x_2,y_1,y_2)  & = \left(x_1 < y_1\right) \land \left(y_1 < x_2\right) \land
      \left(x_2 < y_2\right) \\
    \startsf(x_1,x_2,y_1,y_2)    & = \left(x_1 = y_1\right) \land \left(y_1 < x_2\right) \land
      \left(x_2 < y_2\right) \\
    \finishesf(x_1,x_2,y_1,y_2)  & = \left(y_1 < x_1\right) \land \left(x_1 < x_2\right) \land
      \left(x_2 = y_2\right) \\
    \containedf(x_1,x_2,y_1,y_2) & = \left(y_1 < x_1\right) \land \left(x_1 < x_2\right) \land
      \left(x_2 < y_2\right) \\
  \end{align*}
\end{defn}

\begin{thm}
  Given a strict linear order $L$, $\inter[L]$ is a model of $\taia$ under the above
  interpretations.
\end{thm}
\begin{proof}
  %TODO: proof
  Tedious proof by cases goes here.
\end{proof}

\begin{cor}
  Allen's interval algebras are satisfiable
\end{cor}

The theory is satisfiable in a reasonable way, including the expected models induced from linear
orders. To further support this tight connection, we see interval algebras also induce a quite
reasonable linear order

\begin{defn}
  Given an Allen interval algebra $A$, we define $\points[A] = \frac{A + A}{\psim}$ where
  $\psim$ is an equivalence relation on the set $A + A$ defined by
  \begin{equation*}
    (n,I) \psim (m,J) \iff A \models \peq(n,m)(I,J)
  \end{equation*}
  Where $\peq$ assigns $\laia$-formulas with open variables $I,J$ to pairs $(n,m) \in \{0,1\}^2$
  \begin{equation*}
    \peq(n,m)(I,J) = \begin{cases}
      I \starts J \lor I \startedby J \lor I = J \quad & \text{if } n = m = 0\\
      I \finishes J \lor I \finishedby J \lor I = J    & \text{if } n = m = 1 \\
      I \metby J                                       & \text{if } n = 0,\ m = 1 \\
      I \meets J                                       & \text{if } n = 1,\ m = 0
    \end{cases}
  \end{equation*}
\end{defn}

\begin{thm}
  Given an Allen interval algebra $A$, the interpretation of the symbol $<$ in $\points[A]$ given by
  $(n,I) < (m,J) \iff A \models \plt(n,m)(I,J)$ is well-defined and turns $A$ into a model of
  $\tslo$.

  Here, $\plt$ is a function assigning $\laia$-formulas with open variables $I,J$ to pairs
  $(n,m) \in \{0,1\}^2$ defined as:
  \begin{equation*}
    \plt(n,m)(I,J) = \begin{cases}
      I \before J \lor I \meets J \lor I \overlaps J  \lor I \finishedby J \lor I \contains J
                                                & \text{if } n = m = 0\\
        I \before J \lor I \meets J \lor I \overlaps J \lor I \starts J \lor I \contained J
                                                & \text{if } n = m = 1 \\
      \lnot\,(I \after J) \land \lnot\,(I \metby J) \land \lnot\,(I \startedby J)
                                                & \text{if } n = 0,\ m = 1 \\
      I \before J                               & \text{if } n = 1,\ m = 0
    \end{cases}
  \end{equation*}
\end{thm}
\begin{proof}
  %TODO: Show that $<$ is well defined

  Now we know that our definition of $<$ does not depend on a choice of representative, we need
  to check whether it satisfies $\tslo$:
  \begin{itemize}
    \item \textbf{irreflexivity}: Fix some element $[(n,I)] \in \points[A]$. Since the interval
      algebra relations (along with equality) are mutually exclusive and $I = I$, no other relation
      can hold for the pair $(I,I)$. Regardless of the value of $n$, $\plt(n,n)(I,I)$ does not
      include $I = I$ as a disjunct, so $A \not\models \plt(n,n)(I,I)$ and $<$ is irreflexive.
    \item \textbf{transitivity}: %TODO: Show transitivity
    \item \textbf{trichotomy}: %TODO: Show trichotomy
  \end{itemize}
\end{proof}

%TODO: Consider adding table justifying these definitions? Something like:
%| I relation J | drawing of I and J | is I- < J- | is I+ < J+ | is I- < J + | is I+ < J - |

Now that this axiomatisation is justified, show that we can't remove any axioms without making
it into something we do not want.

% ------ A slight detour into category theory

\begin{defn}
  Given a theory $\theory$ over language $\lang$, we denote by $\mods{\lang}{\theory}$ the category
  with objects the models of $\theory$ and arrows the $\lang$-embeddings.
\end{defn}

\begin{thm}
  We can turn $\inter$ into a functor
  \begin{equation*}
    \inter : \slos \to \aias
  \end{equation*}
  by sending arrows $f : M \to N$ in $\slos$ to  $\inter[f] : \inter[M] \to \inter[N]$ defined by
  \begin{equation*}
    \inter[f](x_1, x_2) = (f(x_1), f(x_2))
  \end{equation*}
\end{thm}
\begin{proof}
  First we show that for a $\lslo$-embedding $f : L \to M$ between strict linear orders
  $L,M$, the mapping $\inter[f]$ gives a an $\laia$-embedding. Consider the relations in $\laia$,
  and their interpretations in $\inter[L]$: all of the relations are defined by quantifier-free
  $\lslo$-formulas, whose truth value must be preserved under $\lslo$ embeddings like $f$. Since
  $\inter[f]$ simply applies $f$ pointwise, $\inter[f]$ must preserve the truth value of the
  relation symbols in $\laia$, in other words, it is an $\laia$-embedding.

  Now we just need to check that $\inter$ satisfies the two functor axioms:
  \begin{itemize}
    \item \textbf{preserves identity arrows}: Fix some strict linear order $L$ and some interval
      $(x,y) \in \inter[L]$, then
      \begin{equation*}
        \inter[\id{L}](x,y) = (\id{L}(x), \id{L}(y)) = (x,y)
      \end{equation*}
    \item \textbf{respects arrow composition}: Fix three strict linear orders $L,M,N$ along with
      arrows $f : L \to M$, $g : M \to N$ and some interval $(x,y) \in \inter[L]$, then
      \begin{align*}
        \inter[g \circ f](x,y)
          & = (g \circ f(x), g \circ f(y)) \\
          & = (g(f(x)), g(f(y))) \\
          & = \inter[g](\inter[f](x,y)) \\
          & = \inter[g]\circ\inter[f](x,y)
      \end{align*}
  \end{itemize}
\end{proof}

\begin{thm}
  We can turn $\points$ into a functor
  \begin{equation*}
    \points : \aias \to \slos
  \end{equation*}
  by sending arrows $f : A \to B$ in $\aias$ to $\points[f] : \points[A] \to \points[B]$
  defined by
  \begin{equation*}
    \points[f](0, I) = (0, f(I)) \qquad\text{and}\qquad \points[f](1,I) = (1, f(I))
  \end{equation*}
\end{thm}
\begin{proof}
  Given an arrow $f : A \to B$, we must check that $\points[f]$ is a well defined map, and that it
  is an $\lslo$-embedding. These facts both follow by noticing that $f$ is an
  $\laia$-embedding, so it preserves the truth of quantifier-free $\laia$-formulas, so
  \begin{align*}
    (n,I) \psim (m,J)
      & \iff A \models \peq(n,m)(I,J) \\
      & \iff A \models \peq(n,m)(f(I),f(J)) \\
      & \iff (n,f(I)) \psim (m,f(J))
  \end{align*}
  and similarly
  \begin{align*}
    [(n,I)] < [(m,J)]
      & \iff A \models \plt(n,m)(I,J) \\
      & \iff A \models \plt(n,m)(f(I),f(J)) \\
      & \iff \points[f]([(n,I)]) < \points[f]([(m,J)])
  \end{align*}
  for any two $(n,I),(m,J) \in A + A$, since $\peq(n,m)$ and $\plt(n,m)$ are always quantifier-free.

  Next, to see that $\points$ satisfies the functor axioms:
  \begin{itemize}
    \item \textbf{preserves identity arrows}: Fix some interval algebra $A$ and some element
    $[(n, I)] \in \points[A]$. Then notice that
      \begin{equation*}
        \points[\id{A}]([(n,I)]) = [(n, \id{A}(I))] = [(n,I)] = \id{\points[A]}([(n,I)])
      \end{equation*}
      Hence $\points[\id{A}] = \id{\points[A]}$.
    \item \textbf{respects arrow composition}: Fix interval algebras $A,B,C$ along with arrows
      $f : A \to B$, $g : B \to C$. Then for all elements $[(n,I)] \in \points[A]$:
      \begin{align*}
        \points[g \circ f]([(n,I)])
          & = [(n,g \circ f (I))] \\
          & = [(n, g(f(I)))] \\
          & = \points[g]\left( \points[f]([n,I]) \right) \\
          & = \points[g] \circ \points[f] ([n,I])
      \end{align*}
      Hebce $\points[g \circ f] = \points[g] \circ \points[f]$ as expected.
  \end{itemize}
\end{proof}

\begin{thm}
  $\points$ is left adjoint to $\inter$.
\end{thm}
\begin{proof}
  %TODO: proof
  For an interval algebra $A$ and a strict linear order $L$, we have
  \begin{equation*}
    \text{Hom}(\points[A], L) \cong \text{Hom}(A, \inter[L])
  \end{equation*}
  A map of linear orders from the start/end points of A to L, enforces a mapping of interval
  algebras from A to the intervals of L, by checking where the start/end points of the interval end.

  The above map is "canonical" so it should be natural in A and L.
\end{proof}

%TODO: add example where this fails
Notice also that
\begin{equation*}
  \text{Hom}(\inter[L],A) \not\cong \text{Hom}(L, \points[A])
\end{equation*}
Since A does not necessarily have all the intervals given by $\points[A]$, so if we have a map on
the right, it isn't guaranteed that we have a corresponding map on the left.

%TODO: consider the unit and counit some more:
% - counit is always an isomorphism
% - show cases when unit is also an isomorphism?

%TODO: consider what our functors do to elementary embeddings

% ------ Homogeneous tings eh

\begin{thm}
  The class $\finslo$ of finite strict linear orders satisfies the hereditary property (HP),
  the joint embedding property (JEP), the amalgamation property (AP) and is essentially countable
  (EC). In other words, $\finslo$ is a Fraïssé class.
\end{thm}
\begin{proof}
  %TODO: proof
  Something like
  \begin{itemize}
    \item HP: Show the result for all relational, universal theories, since this is referenced in
      the later proof.
    \item JEP: Given two finite strict linear orders, embed them into their disjoint union with
      the left order befored the right order
    \item AP: Given two finite strict linear orders A and B, with C embedding into both,
      embed A and B into their product ordered lexicographically
    \item EC: Show the result for all finite languages, since this is referenced in the later proof.
  \end{itemize}
\end{proof}

\begin{thm}
  The Fraïssé limit of $\finslo$ is $\Q$
\end{thm}
\begin{proof}
  %TODO: proof
  Show that $\Q$ is homogeneous and that its age is $\finslo$.
\end{proof}

\begin{thm}
  The class $\finaia$ of finite interval algebras is a Fraïssé class.
\end{thm}
\begin{proof}
  First, notice that $\points$ must send finite interval algebras to finite strict linear orders.
  In fact, given an interval algebra $A$, $|\points[A]| \leq 2|A|$ since
  $\points[A]$ is a quotient of $A + A$. Similarly, $\inter$ must also send finite strict linear
  orders to finite interval algebras: given a strict linear order $L$, $|\inter[L]| = |L|^2$.

  Next, with this in mind, we check the Fraïssé class conditions:
  \begin{itemize}
    \item \textbf{HP}: This follows from the fact that $\laia$ is a relational language and
      $\taia$ is a universal theory, same as the case for strict linear orders.
    \item \textbf{JEP}: Given two finite interval algebras $A$ and $B$, we use the JEP of strict
      linear orders to get the following diagram in $\slos$
      \[\begin{tikzcd}
        {\points[A]} \\
        && \Omega \\
        {\points[B]}
        \arrow["f", from=1-1, to=2-3]
        \arrow["g"', from=3-1, to=2-3]
      \end{tikzcd}\]
      Then, applying $\inter$ and using the adjunction unit $\eta$, we get
      % https://q.uiver.app/?q=WzAsNSxbMiwwLCJcXGludGVyW1xccG9pbnRzW0FdXSJdLFsyLDIsIlxcaW50ZXJbXFxwb2ludHNbQl1dIl0sWzQsMSwiXFxpbnRlcltcXE9tZWdhXSJdLFswLDAsIkEiXSxbMCwyLCJCIl0sWzAsMiwiXFxpbnRlcltmXSIsMCx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzEsMiwiXFxpbnRlcltnXSIsMix7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzQsMSwiXFx1bml0e0J9IiwyXSxbMywwLCJcXHVuaXR7QX0iXV0=
      \[\begin{tikzcd}
        A && {\inter[\points[A]]} \\
        &&&& {\inter[\Omega]} \\
        B && {\inter[\points[B]]}
        \arrow["{\inter[f]}", color={rgb,255:red,214;green,92;blue,92}, from=1-3, to=2-5]
        \arrow["{\inter[g]}"', color={rgb,255:red,214;green,92;blue,92}, from=3-3, to=2-5]
        \arrow["{\unit{B}}"', from=3-1, to=3-3]
        \arrow["{\unit{A}}", from=1-1, to=1-3]
      \end{tikzcd}\]
      And the composites $\inter[f] \circ \unit{A}$ and $\inter[g] \circ \unit{B}$ along with
      the interval algebra $\Omega$ give us the joint embedding of $A$ and $B$.
    \item \textbf{AP}: Suppose we have the following diagram in $\aias$
      % https://q.uiver.app/?q=WzAsNCxbMiwwLCJBIl0sWzIsMiwiQiJdLFswLDEsIkMiXSxbNCwxXSxbMiwwLCJmIl0sWzIsMSwiZyIsMl1d
      \[\begin{tikzcd}
        && A \\
        C &&&& {} \\
        && B
        \arrow["f", from=2-1, to=1-3]
        \arrow["g"', from=2-1, to=3-3]
      \end{tikzcd}\]
      Applying $\points$ takes us to $\slos$, at which point we can use the AP of strict linear
      orders to get the commuting square
      % https://q.uiver.app/?q=WzAsNCxbMiwwLCJcXHBvaW50c1tBXSJdLFsyLDIsIlxccG9pbnRzW0JdIl0sWzAsMSwiXFxwb2ludHNbQ10iXSxbNCwxLCJcXE9tZWdhIl0sWzIsMCwiXFxwb2ludHNbZl0iLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFsyLDEsIlxccG9pbnRzW2ddIiwyLHsiY29sb3VyIjpbMCw2MCw2MF19LFswLDYwLDYwLDFdXSxbMCwzLCJmJyJdLFsxLDMsImcnIiwyXV0=
      \[\begin{tikzcd}
        && {\points[A]} \\
        {\points[C]} &&&& \Omega \\
        && {\points[B]}
        \arrow["{\points[f]}", color={rgb,255:red,214;green,92;blue,92}, from=2-1, to=1-3]
        \arrow["{\points[g]}"', color={rgb,255:red,214;green,92;blue,92}, from=2-1, to=3-3]
        \arrow["{f'}", from=1-3, to=2-5]
        \arrow["{g'}"', from=3-3, to=2-5]
      \end{tikzcd}\]
      Now going back to $\aias$ gives the commuting diagram
      % https://q.uiver.app/?q=WzAsOSxbNCwwLCJcXGludGVyW1xccG9pbnRzW0FdXSJdLFs0LDIsIlxcaW50ZXJbXFxwb2ludHNbQl1dIl0sWzIsMSwiXFxpbnRlcltcXHBvaW50c1tDXV0iXSxbNiwxLCJcXGludGVyW1xcT21lZ2FdIl0sWzAsMSwiQyJdLFswLDBdLFsxLDBdLFsyLDAsIkEiXSxbMiwyLCJCIl0sWzIsMCwiXFxpbnRlcltcXHBvaW50c1tmXV0iLDEseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFsyLDEsIlxcaW50ZXJbXFxwb2ludHNbZ11dIiwxLHsiY29sb3VyIjpbMCw2MCw2MF19LFswLDYwLDYwLDFdXSxbMCwzLCJcXGludGVyW2YnXSIsMCx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzEsMywiXFxpbnRlcltnJ10iLDIseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFs4LDEsIlxcdW5pdHtCfSIsMl0sWzcsMCwiXFx1bml0e0F9Il0sWzQsMiwiXFx1bml0e0N9IiwxXSxbNCw3LCJmIl0sWzQsOCwiZyIsMl1d
      \[\begin{tikzcd}
        {} & {} & A && {\inter[\points[A]]} \\
        C && {\inter[\points[C]]} &&&& {\inter[\Omega]} \\
        && B && {\inter[\points[B]]}
        \arrow["{\inter[\points[f]]}"{description}, color={rgb,255:red,214;green,92;blue,92}, from=2-3, to=1-5]
        \arrow["{\inter[\points[g]]}"{description}, color={rgb,255:red,214;green,92;blue,92}, from=2-3, to=3-5]
        \arrow["{\inter[f']}", color={rgb,255:red,214;green,92;blue,92}, from=1-5, to=2-7]
        \arrow["{\inter[g']}"', color={rgb,255:red,214;green,92;blue,92}, from=3-5, to=2-7]
        \arrow["{\unit{B}}"', from=3-3, to=3-5]
        \arrow["{\unit{A}}", from=1-3, to=1-5]
        \arrow["{\unit{C}}"{description}, from=2-1, to=2-3]
        \arrow["f", from=2-1, to=1-3]
        \arrow["g"', from=2-1, to=3-3]
      \end{tikzcd}\]
      For the AP of the finite interval algebras, we are only interested in the outer square. The
      necessary maps are then $\inter[f'] \circ \unit{A}$ and $\inter[g'] \circ \unit{B}$, both
      mapping into $\inter[\Omega]$.
    \item \textbf{EC}: Follows from the fact that $\laia$ is finite, similarly to the strict linear
      order case.
\end{itemize}
\end{proof}

\begin{thm}
  The Fraïssé limit of $\finaia$ is $\inter[\Q]$
\end{thm}
\begin{proof}
  To show that the Fraïssé limit of the finite interval algebras is $\inter[\Q]$, it suffices to
  show the following:
  \begin{itemize}
    \item $\age{\inter[\Q]} = \finaia$: We show that both sides include into the other. First,
      suppose we have some finitely generated $\laia$-substructure $A \subset \inter[\Q]$. Since
      $\taia$ is universal, $A$ must also be an interval algebra. Furthermore, since $\laia$ is
      relational, $A$ must also be finite, so $A \in \finaia$. For the converse inclusion, consider
      some finite interval algebra $A$, it must embed into $\inter[\points[A]]$, which in turn
      embeds into $\inter[\Q]$ (since $\points[A]$ is finite, hence embeddable into $\Q$).
      Restricting these composition of these embeddings onto their image in $\inter[\Q]$ then gives
      the needed isomorphism.
    \item $\inter[\Q]$ is homogeneous: fix two $\laia$-substructures $A,B \subseteq \inter[\Q]$,
      along with some $\laia$-isomorphism $f : A \to B$. In essence we have the following
      diagram of interval algebras, where $i$ and $j$ are the inclusions into $\inter[\Q]$:
      % https://q.uiver.app/?q=WzAsNCxbMCwyLCJBIl0sWzIsMiwiQiJdLFswLDAsIlxcaW50ZXJbUV0iXSxbMiwwLCJcXGludGVyW1FdIl0sWzAsMSwiZiJdLFswLDIsImkiXSxbMSwzLCJqIiwyXV0=
      \[\begin{tikzcd}
        {\inter[Q]} && {\inter[Q]} \\
        \\
        A && B
        \arrow["f", from=3-1, to=3-3]
        \arrow["i", from=3-1, to=1-1]
        \arrow["j"', from=3-3, to=1-3]
      \end{tikzcd}\]
      Applying $\inter$ to move to linear orders, we can postcompose $\points[i]$ and $\points[j]$ with
      the counit at $\Q$ to realise $\points[A]$ and $\points[B]$ as $\lslo$-substructures of $\Q$.
      Now, $\points[f]$ is still an isomorphism as these are preserved by functors, and using the
      fact that $\Q$ is homogeneous, we can extend $\points[f]$ to an isomorphism $g$, giving the
      commuting diagram
      % https://q.uiver.app/?q=WzAsNyxbMCw0LCJcXHBvaW50c1tBXSJdLFsyLDQsIlxccG9pbnRzW0JdIl0sWzAsMiwiXFxwb2ludHNbXFxpbnRlcltcXFFdXSJdLFsyLDIsIlxccG9pbnRzW1xcaW50ZXJbXFxRXV0iXSxbMCwwLCJcXFEiXSxbMiwwLCJcXFEiXSxbMCwxXSxbMCwxLCJcXHBvaW50c1tmXSIsMCx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzAsMiwiXFxwb2ludHNbaV0iLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFsyLDQsIlxcY291bml0e1xcUX0iXSxbMyw1LCJcXGNvdW5pdHtcXFF9IiwyXSxbMSwzLCJcXHBvaW50c1tqXSIsMix7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzQsNSwiZyJdXQ==
      \[\begin{tikzcd}
        \Q && \Q \\
        {} \\
        {\points[\inter[\Q]]} && {\points[\inter[\Q]]} \\
        \\
        {\points[A]} && {\points[B]}
        \arrow["{\points[f]}", color={rgb,255:red,214;green,92;blue,92}, from=5-1, to=5-3]
        \arrow["{\points[i]}", color={rgb,255:red,214;green,92;blue,92}, from=5-1, to=3-1]
        \arrow["{\counit{\Q}}", from=3-1, to=1-1]
        \arrow["{\counit{\Q}}"', from=3-3, to=1-3]
        \arrow["{\points[j]}"', color={rgb,255:red,214;green,92;blue,92}, from=5-3, to=3-3]
        \arrow["g", from=1-1, to=1-3]
      \end{tikzcd}\]
      Finally, we apply $\inter$ to bring us back to interval algebras, where we have the following
      diagram:
      % If modifying diagram, don't forget to add [scale cd=0.91]
      % https://q.uiver.app/?q=WzAsMTIsWzIsNCwiXFxpbnRlcltcXHBvaW50c1tBXV0iXSxbNCw0LCJcXGludGVyW1xccG9pbnRzW0JdXSJdLFsyLDIsIlxcaW50ZXJbXFxwb2ludHNbXFxpbnRlcltcXFFdXV0iXSxbNCwyLCJcXGludGVyW1xccG9pbnRzW1xcaW50ZXJbXFxRXV1dIl0sWzIsMCwiXFxpbnRlcltcXFFdIl0sWzQsMCwiXFxpbnRlcltcXFFdIl0sWzQsNiwiQiJdLFsyLDYsIkEiXSxbNiwyLCJcXGludGVyW1xcUV0iXSxbMCwyLCJcXGludGVyW1xcUV0iXSxbMCw0LCJBIl0sWzYsNCwiQiJdLFswLDEsIlxcaW50ZXJbXFxwb2ludHNbZl1dIiwwLHsiY29sb3VyIjpbMCw2MCw2MF19LFswLDYwLDYwLDFdXSxbMSwzLCJcXGludGVyW1xccG9pbnRzW2ldXSIsMCx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzAsMiwiXFxpbnRlcltcXHBvaW50c1tpXV0iLDIseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFsyLDQsIlxcaW50ZXJbXFxjb3VuaXR7XFxRfV0iLDIseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFszLDUsIlxcaW50ZXJbXFxjb3VuaXR7XFxRfV0iLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFs0LDUsIlxcaW50ZXJbZ10iLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFs3LDAsIlxcdW5pdHtBfSIsMl0sWzYsMSwiXFx1bml0e0J9Il0sWzgsMywiXFx1bml0e1xcaW50ZXJbXFxRXX0iXSxbOSwyLCJcXHVuaXR7XFxpbnRlcltcXFFdfSIsMl0sWzgsNSwiXFxpZHtcXGludGVyW1xcUV19IiwyLHsiY3VydmUiOjN9XSxbOSw0LCJcXGlke1xcaW50ZXJbXFxRXX0iLDAseyJjdXJ2ZSI6LTN9XSxbNyw2LCJmIiwyXSxbMTAsOSwiaSJdLFsxMCwwLCJcXHVuaXR7QX0iLDJdLFs3LDEwLCJcXGlke0F9IiwwLHsiY3VydmUiOi0zfV0sWzExLDgsImoiLDJdLFsxMSwxLCJcXHVuaXR7Qn0iXSxbNiwxMSwiXFxpZHtCfSIsMix7ImN1cnZlIjozfV1d
      \[\begin{tikzcd}[scale cd=0.91]
        && {\inter[\Q]} && {\inter[\Q]} \\
        \\
        {\inter[\Q]} && {\inter[\points[\inter[\Q]]]} && {\inter[\points[\inter[\Q]]]} && {\inter[\Q]} \\
        \\
        A && {\inter[\points[A]]} && {\inter[\points[B]]} && B \\
        \\
        && A && B
        \arrow["{\inter[\points[f]]}", color={rgb,255:red,214;green,92;blue,92}, from=5-3, to=5-5]
        \arrow["{\inter[\points[i]]}", color={rgb,255:red,214;green,92;blue,92}, from=5-5, to=3-5]
        \arrow["{\inter[\points[i]]}"', color={rgb,255:red,214;green,92;blue,92}, from=5-3, to=3-3]
        \arrow["{\inter[\counit{\Q}]}"', color={rgb,255:red,214;green,92;blue,92}, from=3-3, to=1-3]
        \arrow["{\inter[\counit{\Q}]}", color={rgb,255:red,214;green,92;blue,92}, from=3-5, to=1-5]
        \arrow["{\inter[g]}", color={rgb,255:red,214;green,92;blue,92}, from=1-3, to=1-5]
        \arrow["{\unit{A}}"', from=7-3, to=5-3]
        \arrow["{\unit{B}}", from=7-5, to=5-5]
        \arrow["{\unit{\inter[\Q]}}", from=3-7, to=3-5]
        \arrow["{\unit{\inter[\Q]}}"', from=3-1, to=3-3]
        \arrow["{\id{\inter[\Q]}}"', curve={height=18pt}, from=3-7, to=1-5]
        \arrow["{\id{\inter[\Q]}}", curve={height=-18pt}, from=3-1, to=1-3]
        \arrow["f"', from=7-3, to=7-5]
        \arrow["i", from=5-1, to=3-1]
        \arrow["{\unit{A}}"', from=5-1, to=5-3]
        \arrow["{\id{A}}", curve={height=-18pt}, from=7-3, to=5-1]
        \arrow["j"', from=5-7, to=3-7]
        \arrow["{\unit{B}}", from=5-7, to=5-5]
        \arrow["{\id{B}}"', curve={height=18pt}, from=7-5, to=5-7]
      \end{tikzcd}\]
      Although not obvious at first, the above diagram commutes, to check this we look at all the
      "irreducible components" individually:
      \begin{itemize}
        \item The middle rectangle in red commutes since it already commuted for linear orders.
        \item The top triangles commute by triangle identities of our adjunction.
        \item The squares to the left, right and bottom of the red rectangle commute by naturality
          of the unit.
        \item The bottom triangles commute due to the use of the identity.
      \end{itemize}
      Chasing around the outside of the diagram, we see that
      \begin{equation*}
        \inter[g] \circ \id{\inter[\Q]} \circ i \circ \id{A} =
          \id{\inter[\Q]} \circ j \circ \id{B} \circ f
      \end{equation*}
      Simplifying by removing identities shows that $\inter[g] \circ i = j \circ f$. Now, since $g$
      was an isomorphism, so is $\inter[g]$, so we have successfully extended $f$ to an
      automorphism of $\inter[\Q]$.
  \end{itemize}
\end{proof}

% TODO: Fraisse Limits can be seen as a type of colimit, look into this?
% It's interesting that this colimit is preserved by a right adjoint, namely Int(-)
% WARNING: Not sure if the following makes any sense, I am quite tired -- I suspect my reasoning is
% somewhat flawed though?
% I guess it happens since Pts(Int(-)) is naturally isomorphic to Id(-),
% So suppose the colimit of some diagram D(-) exists for linear orders,
% then if the colimit of Pts(D(-)) exists, it must be isomorphic to the Pts(colimit of D(-))
% This is because left adjoints preserve colimits, so Int(colimit of Pts(D(-))) is the colimit of
% Int(Pts(D(-))), and since Ints(Pts(D(-))) is naturally isomorphic to D(-), the colimit of
% Int(Pts(D(-))) must also be isomorphic to the colimit of D(-)

% ------ Stability theory

\begin{thm}
  An interval algebra $A$ is stable if and only if it is finite.
\end{thm}
\begin{proof}
  %TODO: proof
  Finite models are always stable since they cannot have infinitely many elements.

  For an infinite model $A$, we can linearly order the intervals in $A$, showing $A$ is unstable.
\end{proof}

\begin{thm}
  If a model M is interpretable in an NIP model, then M must also be NIP
\end{thm}
\begin{proof}
  %TODO: proof
  Prove the contrapositive (if M is IP, then anything M is interpretable in is IP)
  If M is interpretable in $N^k$, and there is a formula $\phi$ which has the IP in M,
  then viewing this formula as a formula over $N$ implies that $N$ is also IP.
\end{proof}

\begin{cor}
  Given an NIP linear order $L$, the interval algebra $\inter[L]$ is also NIP.
\end{cor}
\begin{proof}
  %TODO: proof
  $\inter[L]$ is interpretable in $L$ by its construction.
\end{proof}

\begin{thm}
  Given an linear order $L$ with no upper bound (or no lower bound), $L$ is an NIP model if and only
  if $\inter[L]$ is an NIP model.
\end{thm}
\begin{proof}
  %TODO: proof
  The left to right implication holds by the previous corollary.
  For the right to left implication, we notice that we can interpret the linear order $L$ in
  $\inter[L]$ as it has no upper bound (use a construction similar to Points where we only consider
  the end points of an interval -- the lower bound analogue follows from the start point
  construction).
\end{proof}

\end{document}
